# Daily Log - 2026-02-09

## Overview
Work focused on stabilizing Lumi's code sandbox, improving personality responsiveness, and reducing fallbacks during LLM calls. The app UI was consolidated so there is a single code sandbox/editor flow, and the sandbox now consistently receives code from assistant responses. Several reliability fixes were added to prevent timeouts and ensure code requests get higher quality and fuller responses.

## Changes and Additions

### 1) Personality System: Behavior and Quality Tiers
- Upgraded sentiment analysis and rapport tracking so response quality degrades or improves based on user behavior.
- Added weighted keyword tiers, phrase detection, negation handling, and ALL-CAPS intensity.
- Added response quality tiers (0-4) that affect the system prompt and refusal behavior.
- Updated IPC handling so requests carry personality tier into the model prompt.

Files:
- src/core/personality/PersonalityEngine.ts
- src/main.ts
- src/core/brain/index.ts

### 2) Code Sandbox: Single Source of Truth
- Replaced the old textarea UI with Monaco-based editor integration in the main UI.
- Merged code responses into the existing sandbox editor instead of replacing it.
- Added code context injection so follow-up edits build on existing code.
- Added a single sandbox API (window.codeSandbox) so any UI can route code into the main editor.
- Removed the secondary React sandbox UI (AutoCodeBox editor) and made it only forward code to the main sandbox.
- Ensured the code panel is draggable only from its header to allow text selection in the editor.

Files:
- index.html
- src/components/AutoCodeBox.tsx

### 3) Sandbox Controls and Behavior
- Added a clear button for the sandbox to reset code.
- Removed pause/resume behavior to avoid blocking code merges.
- Auto-merging is now always on.

Files:
- index.html

### 4) LLM Reliability and Code Quality
- Added code-quality system prompt for code requests to encourage complete, working outputs.
- Increased timeouts and token budgets for code-heavy prompts in the renderer.
- Added abort detection and retry logic in the brain layer to avoid fallback when Ollama aborts.

Files:
- src/core/brain/index.ts
- index.html

### 5) Security/Quarantine Adjustments
- Stopped quarantining content that is only flagged as code-like so assistant code outputs are not blocked.

Files:
- src/main.ts

### 6) CSP and Monaco Workers
- Updated CSP to allow Monaco web workers (worker-src with blob/data).

Files:
- index.html

## Notable Behavior Changes
- There is now only one code sandbox/editor. All assistant code funnels into that editor.
- Code context is always included in model prompts when present.
- LLM requests for code have a larger timeout and retry once if aborted.
- Clear now resets the sandbox without disabling auto-merge.

## Known Issues/Observations
- Ollama can still abort on very large generations if the model is slow or overloaded. The new retry and higher timeout reduce this, but heavy requests may still fail depending on system load.
- If a coder model is not available, some code outputs may be weaker than desired. Consider switching to a code-focused model for larger tasks.

## Tests/Verification Performed
- TypeScript checks with npx tsc --noEmit (no errors reported).
- Vite build (npx vite build) succeeded with expected chunk size warnings.

## Files Touched (Summary)
- index.html
- src/core/personality/PersonalityEngine.ts
- src/main.ts
- src/core/brain/index.ts
- src/preload.ts
- src/components/AutoCodeBox.tsx

## Next Steps (Optional)
- Add automatic model switching for code tasks (e.g., qwen2.5-coder) when available.
- Add a single code history/snapshot view tied directly to the sandbox session.
- Add a compact status chip showing active code language in the sandbox header.

---

## Addendum - Release Prep and Ops

### CI and Build Validation
- Fixed CI to skip legacy unit test scripts when the `test/` folder is absent.
- GitHub Actions build-and-test (Node 18.x) passed after the fix.

### CI Failure Root Cause and Resolution
- Failure was caused by the workflow trying to run `node test/test_tokenizer.js` after the `test/` folder was removed.
- Updated the CI script to guard unit test execution with a `test/` directory check and log a skip message when absent.
- Result: build pipeline green with the same Node version (18.20.8) and no new warnings beyond npm deprecations.

### Dependency and Audit Observations
- npm install produced deprecation warnings (glob, asar, electron-osx-sign, boolean) and reported vulnerabilities.
- No immediate action taken during release prep; audit remediation deferred to avoid destabilizing the release branch.

### Build and Smoke Verification
- Executed `npm run prelaunch:checks` (TypeScript compile + production smoke test).
- Smoke test validated production utilities, IPC handlers, preload API exposure, app structure, and userData paths.
- Confirmed Windows userData path resolved correctly under AppData Roaming.

### Beta Feedback and Issue Tracking
- Created Typeform feedback form: https://form.typeform.com/to/e5Ah8l7C
- Added GitHub issue templates (bug report, feature request, question).

### Issue Template Details
- Added templates under .github/ISSUE_TEMPLATE for bug reports, feature requests, and questions.
- Added a config.yml contact link pointing to the Typeform feedback URL.
- Enabled a clean intake path for beta feedback vs. bug/feature issues.

### Prelaunch Checks
- Ran `npm run prelaunch:checks` (TypeScript + production smoke test) and passed.

### Release Assets and Draft Status
- Tag v0.1.0-beta already exists and is pushed.
- GitHub release draft exists with Windows installer attached.
- macOS and Linux artifacts were intentionally skipped for this beta cut.

### Release Published
- Published the v0.1.0-beta GitHub release.

### Documentation Consolidation
- Merged startup documentation into README and removed the duplicate startup file.

### Documentation and Checklist Hygiene
- README now acts as the single source of onboarding and startup guidance.
- docs/STARTUP_README.md removed to prevent drift and duplication.
- Private planning checklists kept locally; added ignore rules to keep them out of GitHub.
- Local checklist tracking updated to reflect current launch-day status.

### Repo Hygiene
- Ignored private planning checklists to keep them out of GitHub.

### Git Activity Summary
- Committed CI workflow fix to prevent missing test script failures.
- Committed issue templates and pushed to origin.
- Committed merged README and removed the duplicate startup doc.
- Checklist files were removed from tracking while preserved locally.

### Follow-ups
- Verify README links before release.
- Publish the GitHub release draft.
- Announce beta and monitor incoming feedback.

---

## Addendum - Launch Completion Details

### Release and Launch Tasks
- Published the v0.1.0-beta GitHub release.
- Confirmed release tag and Windows installer attachment were in place.
- Prepared announcement copy for GitHub and external channels.

### README and Documentation Hygiene
- Verified README link targets and removed the stale README_DEV reference.
- Consolidated documentation list to only existing docs.
- Recorded launch status updates in TODO_STATUS and checklists.

### CI Stabilization and Workflow Health
- Updated CI to skip legacy test scripts when `test/` is missing.
- Verified GitHub Actions build-and-test succeeded on Node 18.x.

### Repo Privacy and Cleanup
- Removed privacy audit result artifacts from the repo history.
- Added ignore rules for audit artifacts and builder debug output.
- Redacted user-specific paths in release/builder-debug.yml.

### Feedback and Issue Intake
- Typeform feedback link finalized and ready for announcements.
- GitHub issue templates (bug/feature/question) added with a feedback contact link.

### Monitoring Plan (Ongoing)
- Watch GitHub Issues for first bug reports.
- Check Typeform responses daily for early feedback.
- Respond to early adopters and triage reports quickly.

### Status Snapshot
- Beta readiness: final launch-day actions remain (link verification, publish, announce).
- Feedback intake: Typeform live, GitHub templates live.
- CI: green on Node 18.x after workflow fix.
