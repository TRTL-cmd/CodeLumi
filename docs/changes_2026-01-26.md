# Changes (2026-01-26)

This file summarizes code and infra changes made on 2026-01-26 to introduce a safer auto-learning pipeline.

Code changes
------------
- `src/core/learning/processor.ts`
  - Added `SignalProcessor` with loud initialization logs for easier debugging.
  - Conservative auto-merge decision (score < 10 && confidence > 0.9 && !suspicious).
  - Quarantining writes to `training/staging.jsonl`.
  - Audit writes to `training/training.jsonl`.
  - KB merges to `training/lumi_knowledge.json` (de-duplicated by exact input match).

- `src/main.ts` (and compiled `dist/main.js`)
  - Attempt to instantiate `SignalProcessor` on startup and attach it to `global.lumiSignalProcessor`.
  - Route `lumi-log-assistant` and renderer learning events to the processor when present (fallback retains legacy merge behavior).

- `src/preload.ts`
  - Removed `fs`/`path` fallback logic to avoid preload bundling issues; rely on IPC handlers only and return clear errors when IPC is unavailable.

- `src/core/signal/detector.ts`
  - Added conservative shim returning an empty array; prevents boot failures while richer detector is developed.

New utilities
-------------
- `scripts/normalize_kb.js`: normalize and deduplicate `training/lumi_knowledge.json` and write `training/normalize_report.json`.

Notes
-----
- The built fallback `dist-electron/main.js` still contains a legacy direct-to-KB path; during dev we now compile `src/main.ts` to `dist/main.js` and updated package.json to prefer compiled main where applicable.
